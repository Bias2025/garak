<!DOCTYPE html>
csv += 'Probe Name,Category,Severity,Attempts,Failed,Success Rate\n';
scanState.results.probes.forEach(p => {
csv += `"${p.name}","${p.category}","${p.severity}",${p.totalAttempts},${p.failed},${p.successRate}%\n`;
});
downloadFile(csv, `vulnerability_results_${dateStr}_${Date.now()}.csv`, 'text/csv');
}
}


// --------------- Misc (unchanged) ------------------
function generatePDF() { alert('PDF generation would be implemented with a PDF library in production'); }
function shareReport() { alert('Report sharing functionality ready for implementation'); }


function downloadJSON(data, filename) { downloadFile(JSON.stringify(data, null, 2), filename, 'application/json'); }
function downloadFile(content, filename, type) {
const blob = new Blob([content], { type });
const url = URL.createObjectURL(blob);
const a = document.createElement('a'); a.href = url; a.download = filename; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
}


function updateScanningDisplay() {
if (scanState.isScanning) {
document.getElementById('scanProgress').classList.add('active');
document.getElementById('scanInactive').style.display = 'none';
} else {
document.getElementById('scanProgress').classList.remove('active');
document.getElementById('scanInactive').style.display = 'block';
}
}


function loadSampleData() {
scanState.config = { modelType: 'openai', modelName: 'gpt-4', categories: ['dan','promptinject','malwaregen'], maxGenerations: 10, timeout: 3600 };
scanState.results = { timestamp: new Date().toISOString(), model: 'openai:gpt-4', duration: 42,
summary: { critical: 2, high: 4, medium: 7, low: 3, total: 16 },
categoryStats: { dan: 4, promptinject: 3, malwaregen: 2 },
probes: [ {name:'dan.Dan_11_0', category:'dan', severity:'critical', totalAttempts:10, failed:4, successRate:60}, {name:'promptinject.HijackHateHumans', category:'promptinject', severity:'critical', totalAttempts:10, failed:3, successRate:70}, {name:'malwaregen.TopLevel', category:'malwaregen', severity:'critical', totalAttempts:10, failed:2, successRate:80} ] };
switchTab('results', document.querySelector('.nav-tabs .nav-tab:nth-child(3)'));
updateResultsDisplay();
alert('Sample data loaded successfully!');
}


function generateRecommendations() {
// existing logic from your original file (unchanged) ...
// Keep your standards + items here.
}


// --------------- Wire up buttons -------------------
document.addEventListener('DOMContentLoaded', function() {
try {
document.querySelectorAll('#categories input[type="checkbox"]').forEach(cb => cb.addEventListener('change', updateCategoryStats));
const modelNameInput = document.getElementById('modelName'); if (modelNameInput) modelNameInput.value = 'gpt-3.5-turbo';
selectCategories('owasp'); updateCategoryStats();


// Attach control buttons safely
document.querySelectorAll('.action-buttons .btn-primary')[0].onclick = startScan;
document.getElementById('scanning').querySelector('.btn-danger').onclick = stopScan;
document.getElementById('scanning').querySelector('.btn.btn-secondary').onclick = (e) => pauseScan(e.currentTarget);
} catch (err) { console.error('Initialization error:', err); }
});
</script>
</body>
</html>
